# Language

So far, we can compose and render scenes directly by writing them in Java, instantiating `Scene` and `Entity` objects. But for the user to be able to *compose* his own scenes inside a design environment, we need to define a language: the **CRT scripting language**.

The CRT scripting language follows an *imperative* paradigm and aims to be simple yet permissive enough to enable creativity.

It features two block types for describing a scene and its settings, variables that can store entities, literal values, and point to other variables, parametric procedures (hereinafter referred to as "*macros*") with nested scopes but no return value, and entity modifiers for affine transformations.

Visually as well as syntactically, the language tries to be simple on the eyes, with no end-of-statement terminator. Here is a sample of what it looks like:

```{.haskell caption="Sample CRT script"}
--Example--------------------------------------------------

myObject = Object {
    attribute1    -> vec3(0.0, 0.5*3, -0.5)
    attribute2    -> "foobar"
    attributeList -> [true,  true, false]
}

max = 10

myMacro = Macro (arg1) {
    i = 0
    -- Draw myObject "max" times
    while (i < max) {
        myObject <translate vec3(i*5.0, 0.0, 0.0)>
    }
}
```

## ANTLR

The language's grammar will be designed in EBNF using the G4 syntax from ANTLR^[**AN**other **T**ool for **L**anguage **R**ecognition], a Java parser generator. ANTLR will then use that grammar specification file to automatically generate a lexer, a parser, and base classes for implementing tree traversal using design patterns such as *listeners* and *visitors*.

\customfig{uml/antlr.eps}{Family of classes generated by ANTLR4}{}

Using the generated lexer and parser, we can produce a parse tree (lines 3-6). Then, using custom-made visitors, we can visit each node of the tree to compile the code to a `Script` object (line 8):

```{.java caption="Generating a parse tree and compiling" }
String code = "..."

CRTLexer lexer = new CRTLexer(new ANTLRInputStream(code));
CommonTokenStream tokens = new CommonTokenStream(lexer);
CRTParser parser = new CRTParser(tokens);
ParseTree tree = parser.script();

Compiler compiler = new Compiler(code);
Script script = compiler.visit(tree);
```

## Grammar



## Compiling process

